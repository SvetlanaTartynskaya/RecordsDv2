# Система учета показаний счетчиков (Telegram Bot)

## Описание проекта

Система представляет собой Telegram-бота для автоматизации сбора, валидации и обработки показаний счетчиков. Бот позволяет пользователям загружать файлы Excel с показаниями счетчиков, проводит автоматическую валидацию данных, сохраняет их в базу данных и формирует итоговые отчеты, которые проверяются администраторами.

## Основные возможности

- **Загрузка и валидация данных**: Проверка корректности показаний счетчиков согласно заданным правилам
- **Хранение истории показаний**: Отслеживание изменений показаний во времени
- **Автоматическая проверка показаний**: Выявление аномалий и несоответствий в показаниях
- **Система контроля администраторами**: Подтверждение корректности данных ответственными лицами
- **Формирование итоговых отчетов**: Консолидация всех данных в единый итоговый отчет
- **Сохранение отчетов в базу данных**: Хранение актуальных данных для дальнейшей обработки

## Требования для запуска

- Python 3.7+
- База данных SQLite
- Доступ к API Telegram
- Установленные библиотеки:
  - pandas
  - openpyxl (для работы с Excel)
  - python-telegram-bot
  - sqlite3 (входит в стандартную библиотеку Python)

## Структура проекта

- **check.py**: Основной модуль системы, содержащий классы для валидации и обработки данных
- **Users_bot.db**: База данных SQLite для хранения данных
- **meter_readings/**: Директория для хранения файлов с показаниями счетчиков

## Классы и их назначение

1. **MeterValidator** - Класс для валидации показаний счетчиков:
   - Проверка формата файла
   - Проверка корректности показаний
   - Сравнение с историческими данными
   - Валидация комментариев

2. **FinalReportGenerator** - Класс для формирования итоговых отчетов:
   - Сбор данных из всех файлов
   - Формирование единого отчета
   - Сохранение отчета в базу данных
   - Запрос подтверждения от администраторов

## Правила валидации показаний

1. Текущее показание должно быть больше или равно предыдущему
2. Для счетчиков PM изменение не должно превышать 24 единицы в сутки
3. Для счетчиков KM изменение не должно превышать 500 единиц в сутки
4. При отсутствии показаний обязательно наличие комментария
5. Допустимые комментарии: "В ремонте", "Не исправен счетчик", "Нет на локации"
6. Недопустимы дубликаты счетчиков (одинаковый инв. номер и тип счетчика)

## Инструкция по установке

1. Клонировать репозиторий
2. Установить необходимые зависимости:
   ```
   pip install pandas openpyxl python-telegram-bot
   ```
3. Создать Telegram бота через BotFather и получить API токен
4. Настроить конфигурацию бота

## Использование для пользователей

1. Подготовить Excel-файл с показаниями счетчиков в требуемом формате
2. Загрузить файл в чат с ботом
3. Получить результаты валидации
4. При необходимости исправить ошибки и загрузить файл повторно

## Использование для администраторов

1. Получать уведомления о новых отчетах пользователей
2. Проверять корректность показаний
3. Подтверждать проверку нажатием на кнопку "Всё верно"
4. Получать итоговый отчет после подтверждения всеми администраторами

## Формат Excel-файла

Файл с показаниями должен содержать следующие столбцы:
- **Инв. №** - Инвентарный номер оборудования
- **Счётчик** - Тип счетчика (PM, KM и др.)
- **Показания** - Числовое значение показаний
- **Комментарий** - Дополнительная информация о состоянии счетчика (при необходимости)

## Процесс формирования итогового отчета

1. Пользователи загружают показания
2. Система проводит валидацию данных
3. Валидные данные сохраняются в базу данных
4. Администраторы получают уведомления и проверяют данные
5. После подтверждения всеми администраторами формируется итоговый отчет
6. Отчет сохраняется в Excel-файл и в базу данных
7. Администраторы получают уведомление о готовности отчета

## Обработка ошибок

Система ведет подробное логирование всех процессов. При возникновении ошибок информация записывается в лог с указанием деталей проблемы.

## Контакты для поддержки

По вопросам работы системы обращайтесь к администратору. 